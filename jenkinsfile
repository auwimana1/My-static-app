pipeline{
    agent any
    parameters {
        string (name: 'REVISION', defaultValue: '1.0.0')
    }
    


    stages{
        stage("build and push to ecr"){
            steps{
                script {// This step should not normally be used in your script. Consult the inline help for details.
                withDockerRegistry(credentialsId: 'ecr:us-east-1:ecr-revision', url: 'https://557195342730.dkr.ecr.us-east-1.amazonaws.com/') {
                 sh "docker build -t mystaticapp:${params.REVISION} ."
                 sh "docker tag my-app-revision:${params.REVISION} 557195342730.dkr.ecr.us-east-1.amazonaws.com/my-app-revision:${params.REVISION}"
                 sh "docker tag my-app-revision:${params.REVISION} 557195342730.dkr.ecr.us-east-1.amazonaws.com/my-app-revision:latest"
                 sh "docker push 557195342730.dkr.ecr.us-east-1.amazonaws.com/my-app-revision:latest"
                    }
                }
            }
        }
    }
   
}
    